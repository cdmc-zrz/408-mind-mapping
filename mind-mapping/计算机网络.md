# 计算机网络
## 物理层
### 通信基础
#### 三种交换方式
##### 电路交换
###### 优点
* 通信时延小
* 有序传输
* 没有冲突
* 适用范围广
* 实时性强
* 控制简单
###### 缺点
* 建立连接时间长
* 线路独占，利用率低
* 灵活性差
* 难以规格化
* 不提供差错控制功能
##### 报文交换
###### 数据交换的单位是报文，报文携带有目标地址，源地址等信息
###### 优点
* 无须建立连接
* 动态分配线路
* 提高线路可靠性
* 提高线路利用率
* 提供多目标服务
###### 缺点
* 转发延迟高
* 对报文大小没有限制，缓存要求高
###### 主要适用在早起的电报通信网中
##### 分组交换
###### 在报文交换的基础上划分了数据块上限，再加上一些头部的控制信息，构成分组
###### 优点
* 无建立时延
* 线路利用率高
* 简化了存储管理
* 加速传输
* 内少出错概率和重发数据量
###### 缺点
* 存在传输延迟
* 需要传输冗余头部信息
* 要对分组编号，解决失序问题
###### 分组交换的两种方式
* 虚电路
    * 为进行数据传输，需要搭建一条逻辑链路
    * 在建立连接时需要使用目的地址，建立完毕之后只需要加一个很短的虚电路号作为控制信息
    * 属于同一条虚电路的分组按照同一路由转发
    * 保证分组的有序到达，可靠性由网络保证，即虚电路提供可靠的服务
    * 有两种实现方式
        * PVC（永久性虚电路）
        * SVC（临时性虚电路）
        * 前者是建立好的，几乎不需要建立时延，后者是临时性的，需要建立时延
    * 虚电路面向连接，但不适用于出错率很高的链路中，因为虚电路重建成本较高
* 数据报
    * 不需要建立连接
    * 尽最大努力交付，不保证可靠性
    * 需要头部控制信息，可以独立传输
    * 具有冗余路径，一条路径损坏可以更新路由表
    * 收发双方不占用某一链路，资源利用率高
##### 总结
###### 为了使数据在网络中延迟最小，采用电路交换
###### 为保证数据无差错传输，不可采用电路交换（电路交换不会检错纠错）
###### 分组交换相对于报文交换的主要改进是传输单位更小且有固定的最大长度，减少了数据的传输时延
###### 在出错率很高的传输系统中，采用数据报更合适
* 电路交换不检验错
* 因此采用分组方式，而分组方式中虚电路方式的的虚拟链路一旦建立报文段不能自由选择路径，如果有一个结点出错整个链路都要重建
#### 最大信道传输率
##### 奈氏定理
###### 在无噪声的情况下的最大传播速率
###### 理想情况下的最大传播速率=2Wlog2（V）
##### 香农定理
###### 有噪声情况下的最大传播速率
###### 极限传输速率=Wlog2（1+S/N）
* 注意S/N表示信号：噪声
* 题目也可用db作为信噪比，注意个30DB=1000，20DB=100
##### 信道传输率
###### 表示数据进入信道的速度
###### 受影响因素
* 信噪比
* 频率宽带
* 调制速率
##### 真正的最大信道传输率
###### min（奈氏，香农）
###### 类似的还有传输层的最大发送窗口=min（接受窗口，拥塞窗口）
#### 编码与调制
##### 归零编码（RZ）
return zero
###### 每个1后面都要归零
##### 非归零编码（NRZ）
not return zero
###### 最简单的编码方式，1高0低
##### 反向归零编码（NRZI）
never return zero inverted
###### 遇到0时反转高低电平，以是否反转区别01
##### 曼彻斯特编码
###### 局域网常用编码
###### 1为先高后低，2为先低后高
##### 差分曼彻斯特编码
###### 类似于反向曼彻斯特编码
###### 1还是为先高后低，之后的01区分则为0时对前部分码字的后半部分进行翻转，1则和前码字后半部分相同
### 传输介质
#### 双绞线
##### 采用绞和的方式减少电磁干扰
##### STP（shield twist pair）
屏蔽双绞线
##### Unshield twist pair
非屏蔽双绞线
#### 同轴电缆
##### 半双工（CSMA/CD也是半双工）
#### 光纤
##### 全反射
##### 全双工
#### 接口特性
##### 机械特性
###### 大小，材料
##### 电气特性
###### 高低电压为多少伏
##### 功能特性
###### 高低电平各代表什么
##### 规程特性
（过程特性）
###### 用于描述完成各种功能发生顺序
### 物理层设备
#### 放大器
##### 对模拟信号而言
##### 放大模拟信号，即提高模拟信号的振幅
#### 中继器
##### 中继器
###### 多端口中继器
###### 不同层次划分的理解
* 不可以处理多个信息，如果有多个信息同时进入集线器会直接发生碰撞，因此集线器不能隔离冲突域
* 交换机允许多个端口同时输入信息并转发，但是所有接在端口上的主机都会给交换机发信息，因为局域网采用广播方式，会产生广播风暴，因此交换机隔离冲突域但不隔离广播域
* 只有下一跳是对应路由器的数据报才会发给路由器，路由器通过ARP协议传给对应路由器，除非IP地址广播，否则不会收到广播信息，因此称其隔离了广播域
###### 带宽划分
* 因为有冲突的存在，一个10M/s的集线器，有8个主机接入，每个主机只能分得1.25M/s
##### 对于数字信号而言的
###### 对数字信号进行重生整形，而非简单的放大
##### 543规则
###### 互相串联的中继器不超过4个
###### 被划分开来的通信介质不超过5段
###### 5段通信介质中只有三段可以连接计算机
### 补充几个名词
#### 基带传输
##### 数字信号传输
##### 解码块，适用于局域网
#### 频带传输
##### 模拟信号传输
##### 稳定心较好，可以长距离传输
#### 宽带传输
##### 多个模拟信号并发传输
## 数据链路层
### 数据链路层的功能
#### 为网络层提供服务
##### 无确认的无连接服务
##### 有确认的有连接服务
##### 由确认的连接服务
###### TCP
#### 链路管理
##### 主要用于面向连接的服务
#### 桢定界，同步与透明传输
##### 定界
###### 采用编码标注桢的首位
###### 字符计数法
* 桢首部直接标明这个桢多长
###### 字符填充
* 在开始和结束字段前填充转义字符，若在数据段中出现转义字符本身，则在这个字符之前再加一个
###### 零比特填充的首位标志
* 采用0111110作为标志，数据部分逢11111则在后面加0
###### 违规编码
* 违反曼彻斯特编码的原则，在开始和结束位放置违规编码字段
#### 流量控制
##### 对发送方的控制
#### 差错控制
##### 为了避免桢的丢失
###### 超时重传
### 组桢
#### 实质上是定义数据格式
### 差错控制
#### 检错编码
##### 奇偶校验
##### CRC循环冗余检验
###### 1.根据检验多项式的最高次数在编码低位补0
###### 2.按照异或运算（不一样的取1），除以多项式的生成树，取余数
###### 3.这个余数就是校验码，放在数据码之后即可，显然根据数论的知识，如果校验多项式是四位的（最高次项为3），余数为3位
###### 4.接收方接收到数据，对接收到的数据进行模2除法，余数为0则数据没出错
#### 纠错编码
##### 海明码
###### 注意海明不等式
##### 可以看出链路层对数据会进行纠错
##### 码距
###### 检错d位
* d+1位码距
###### 纠错d位
* 2d+1位码距
### 流量控制和可靠传输机制
#### 停止等待
##### 发送窗口1，接受窗口1
##### 确认桢没有帧序号
##### 如果帧丢失，发送端会一直等待
###### 采用超时重传解决
###### NAK机制（补充
* Negative ackowledge，即对传输帧中有小错误的帧的回复
##### 适用范围
###### 网络极其拥堵时
#### 滑动窗口
##### 后退N帧
###### 发送窗口最大可以为2^n-1,接收窗口为1，这里的n为给帧编码的数据位数
###### 采用累计确认机制，确认桢回复3，则表示0123都已经收到
###### 后退N桢的意思就是，如果2345桢发送方均发送，但是接收方没有回复2的确认，则需要从2开始重发，发送窗口会退
###### 信道利用率=（（发送窗口大小）*桢长度/传输速率）//（一个桢发送和确认耗时=RTT+发送时延+接受时延）
* 信道利用率最高为100%
* 信道利用率最高表示在第一个桢发出去之后的传输和确认桢发回来的传输时间，发送方一直都在占用信道发送信息
* 可以通过信道的利用率计算最多可以有多少桢，用于确认用于编码的位数，当位数超过这个桢就没有意义了
###### 在同样编码的情况下，发送窗口通常GBN要大于SR，信道利用率在畅通无阻的情况下是最高的
###### 对于发送窗口为N的情况，最多可以有N桢已发送但未确认
##### 选择重传
###### 在GBN之上改善的传输协议，即在传输失败时不用后退N桢，本质上是因为SR在接收方开放了多个接收窗口，可以缓存发送方的数据，因此发送方重传没接收到的就好了
* 典型的空间换时间算法
* 接收窗口在传输开始就不能变动了，但是TCP的接受窗口大小会随着端进程的需求而动态调整
#### 可靠传输
##### 采用自动重传实现
##### 快重传
###### 三个冗余ACK
#### 信道利用率
##### 发送端占用信道时间/（一个桢的发送时延+RTT+确认桢发送延迟）
### 介质访问控制
#### MAC协议提供的均为无连接不可靠的服务
#### 静态划分信道
##### 基础是多路复用技术和分用技术
###### 多路复用：把多个低速信道组合成一个高速信道，从而提高信道的利用率
###### 分用：在接收方根据信号的特点拆分组合信号传递给不同的接受端
###### 常见信道划分方式
* 频分多路复用（FDM）
frequence divided multiple
* 波分多路复用（WDM）
weave divided multiple
* 时分多路复用（TDM）
time divided multiple
* 码分多路复用（CDM）
code divided multiple
    * 码分多址（CDMA）
code divided multiple address
    * 不同站点的码片互相正交，例如AB两个站点，可采用（1，0），（0，1）作为码片
    * 对于复用信号（2，0，0，2），A可收到（10）B收到（01），采用编码方式划分信号
* 公共信道被N等分，两个信号可以并发传送，但是带宽都比较低，共享时间而不共享空闲
* 两车交替使用车道，共享空间而不共享时间
#### 动态划分信道
##### 随机访问介质控制
###### ALOHA协议
* 纯ALOHA
    * 没有时隙要求，想法就发，遇到冲突重传
    * 信道利用率为0.184
        * 即一个信道的带宽为100，采用ALOHA协议使用上限为18.4
* 改进的ALOHA
    * 只有在一个时隙结束之后才能发
    * 利用率为0.368
###### CSMA
* CSMA(载波监听多点接入)
Carrier sense multiple accesss
    * 1-坚持
        * 规则
            * 空闲
                * 立即发送
            * 忙
                * 坚持侦听
            * 冲突
                * 等待一个随机事件再监听
        * 优缺点
            * 受信道延迟影响大，即CSMA/CD要探讨的问题。没桢听到在其他人发送的同时我们也发送
    * p-检查
        * 规则
            * 空闲
                * 以P概率发送
            * 忙
                * 坚持侦听
            * 冲突
                * 等待一个时间槽之后再监听
        * 优缺点
            * 对1-坚持和非坚持的折中方案
    * 非坚持
        * 不能视作0坚持，因为0坚持发不出数据
        * 规则
            * 空闲
                * 立即发送
            * 忙
                * 随机等待
            * 冲突
                * 随机等待
        * 优缺点
            * 不会有持续桢听到导致的高冲突，但是会有信道完全空闲但是大家都在等待的情况
* CSMA/CD(碰撞检测)
Carrier sense multiple access/collision detection
    * 先听后发，边听边发
        * 最长最短桢听时间
            * 最短：双方同时向对方发送，类似于相遇问题，最快一个单程传输时延就可以侦测到冲突
            * 最长：当对方信道几乎要传到时，刚好发出信号，碰撞检测时间为两个单程传输时间延迟
    * 冲突停发
        * 最小数据帧长
            * 为了保证在侦测到数据冲突时，能够及时止损，不让报文进入信道中，需要一个最小帧长
                * 最小帧长=RTT*数据传输率
                    * 100—base-t数据传输率为100Mb/s
                    * 408喜欢给出信道长度和传递时间，要根据这个东西算出RTT
                    * 以太网最小帧长为64B，首部长度16B，数据长度48B，最长桢为1500B。数据长度1480B
            * 小于最小数据帧长的桢直接丢弃
                * 电缆越长，最小帧长越长
                * 数据传输率越高，最小帧长越长
                * 电缆传输时延越小，最小帧长越长
    * 随机重发
        * 二进制指数退避
            * 如果冲突了就直接重发，会不停的冲突，因此提出指数退避算法
            * 确定基本退避时间，一般为一个RTT
            * 步骤
                * 确定参数K=min（10，重传次数）
                * 从整数（0，1，……2^k-1）中随机取出一个记为r，等待时间为r*rtt
                * 如果16次还没能成功，则直接丢弃，路由器中也定义16为不可达，而IP报文生存时间为64
            * 优点
                * 使重传需要推迟的平均时间随重传次数增大而增大
                * 因而降低碰撞的概率，有利于整体的稳定
* CSMA/CA（碰撞避免）
    * 常用于无线网络
        * 检测电波困难
        * 存在隐蔽站
    * 方式
        * 预约信道
        * ACK帧
        * RTS/CTS桢
    * 总结
        * 不能完全避免冲突
        * 基本思想是发送前广播告知大家，不要占用信道
##### 轮询访问介质控制
###### 逻辑上环形，物理上星型
###### 采用令牌传递，只有拿到令牌的才可以发送信息
###### 显然适用于高负载的网络
### 局域网
#### 局域网就是以太网
#### 以太网的MAC帧
##### IEEE 802.11标准
###### 接受端MAC，发送端MAC，目的地址MAC
##### DIX-V2标准
###### 
* 目的地址：6B
* 源地址：6B
* 类型：IP数据报协议
* FCS：4B
    * 封装在MAC帧尾部
##### 以太网的MAC帧提供的都是无连接不可靠的服务
### 广域网
#### PPP协议
point to point protocol
##### TCP/ip族协议
###### 字节填充，转义字符
#### HDLC协议
High level data link control
##### OSI族协议
###### 位填充，逢11111加一个0
##### 分为三类帧
###### 信息帧
###### 监督帧
###### 确认帧
#### 通信子网主要采用分组交换技术，采用存储转发技术
##### 信息交换采用交换机而不是路由器
##### 是一种网络和互联网有本质区别，在互联网面前广域网和局域网地位是一样的，没有区别
### 数据链路层设备
#### 几个名词解释
##### 交换机
###### 可视为多端口的网桥
###### 特点
* 若采用VLAN技术，可以隔离广播域
* 一般的交换机可以同时处理多个信息，可以避免冲突，但是会把收到的所有信息都转发出去，无法割离广播域
* 每个端口所占用的带宽不会因为结点数目的增加而减少，而整个交换机的总带宽会随着端口结点增加而增加
###### 转发时延
* 直通方式
    * 只检查目的MAC地址，共占用6B，除以交换机带宽即可
* 存储转发方式
    * 检查整个数据帧的正确性，保证转发的可靠性
###### MAC表的建立
* 通过自学习的方法建立MAC表，如果转发的MAC桢目的地址在MAC表中存在表项，则直接转发到对应主机，若没有则发送广播桢
##### 网桥
（注意和网关区别，网关是路由器）
##### 网段
###### 使用同一物理层设备的称为同一个网段，采用数据链路层的设备可以隔离网段
#### 几个层次之间的划分
##### 一个局域网中包含物理层的HUB和链路层的SWITCH，同样还是广播机制，因此可以发现这两个设备均不能隔离广播域
##### 集线器，放大器，中继器
###### 不能隔离任何区域
###### 在物理层实现功能
##### 网桥，交换机
###### 可以隔离冲突域
###### 在链路层，物理层实现功能
##### 路由器
###### 可以隔离广播域和冲突域
###### 在网络层，链路层，物理层实现功能
## 网络层
### 网络层的功能
#### 功能
##### 实现异构网络的互联
###### 异构网络：数据链路层和物理层不同的网络
###### 协议要求：由路由器互联的多个局域网中，物理层和链路层，网络层协议可以不同，而网络层以上的高层协议必须相同
##### 在任意结点之间进行数据报传输
（不保证可靠）
#### 协议要求
#### 路由表
#### 几个在网络层的功能所属层次
##### OSPF
###### IP数据报，是网络层的协议
##### ARP
###### 基于IP数据报，是网络层的协议
##### RIP
###### 基于UDP，是传输层的协议
##### BGP
###### 基于TCP，是传输层的协议
##### NAT
###### 看到端，是传输层的协议
##### DHCP
###### 基于UDP，是传输层的协议
##### PING
###### 基于软件，是应用层的协议
##### IP组播
###### 基于UDP
##### 什么叫做基于UDP和基于IP
###### UDP
* 数据作为UDP报稳中的数据部分
###### IP
* 数据作为IP数据报中的数据部分
###### 基于UDP的要多封装一些信息
### 路由算法
#### 层次路由的几个名词
##### AS（area system）自制系统
##### IGP（inter gateway protocol）内部网关协议
###### OSPF
* 链路状态
* IP协议
* 代价最低（时间）（狄杰斯特拉）
* 网络中所有路由器
* 相邻路由器的链路状态
* 会建立起所有网络的拓扑状态，但是只保存一个下一跳信息
###### RIP
* 距离向量
* UDP协议
* 跳数最少
* 和本结点相邻的路由器
* 自己的路由表
##### EGP（extened gateway protocol）外部网关协议
###### BGP（boundary gateway protocol边界网关协议
* 路径-向量
* TCP协议
* 较好，非最佳
* 和本结点相邻的路由器
* 首次传输整个路由表，非首次传输有变化的部分
#### 路由算法
##### 距离向量路由算法
###### 向相邻结点更新发送路由信息
###### 典型算法
* RIP（routing information protocol）路由信息协议
###### 特点
* 慢收敛
    * 慢收敛是导致距离向量算法出现路由环路问题的根本原因
    * 即坏消息传得慢，网络瘫痪但是其他结点仍存储着以你链接网络的踏板信息，来回之间更新路由向量，实际上网络早就断开了
* 路由环路问题
* 仅和相邻的路由器交换信息，但是交换的是本路由器知道的所有信息
##### 链路状态路由算法
###### 向所有路由结点更新链路状态
###### 典型算法
* OSPF（open shortest path first）开放最短路径算法
###### 采用洪泛法向整个自制系统中的所有路由器发送信息
###### 发送的信息是与本路由器相邻的所有路由器的链路状态，但是这只是路由器知道的部分信息
#### 直接交付和间接交付
##### 直接交付
###### 发送站和目的站在同一网段
###### 直接交付在一个网段内，不涉及路由器
##### 间接交付
###### 发送站和目的站不在同一网段
###### 间接交付的最后一个路由器肯定是直接交付
##### 子网地址相同则称为同一网段
#### 静态路由和动态路由
##### 区别
###### 动态路由会根据网络的通信量或拓扑结构变化而自适应的调整，而静态路由选择则需要手工去调整路由信息
###### 动态路由适合用于大型拓扑结构的调整，而静态路由适合安全性要求高的，主机数较少的网络
##### 静态路由并非开始了就不能调整了，只是需要手工调整
### IPV4
#### 数据报格式
##### 版本
###### IPV4还是IPV6
##### 首部长度
###### 表示整个首部的长度，单位为4B，最大值60B，最小值为20B
##### 总长度
###### 表示整个数据报的长度，单位为字节，最大为65535B，显然，这个长度减去首部长度即为数据部分的长度
##### 标识
###### 用于表示分片数据报的标识，只有标识相同的数据报碎片才能在接收方的主机中重新拼成完整的数据报
##### 标志
###### 物理上占了3位，但是实际上只有两位是有用的即MF（more fragment）和DF（dont fragment）
##### 片偏移
###### 单位为8B，特别需要注意，如果MTU=800B，首部需要20B，那么整个数据报的数据部分最多只能放776（97*8）B的数据，即分片之后只能存储8的整数倍的数据
##### 首部校验和
###### 用于检验首部而不检验数据部分
###### TCP
* 首部和数据部分
###### UDP
* 首部，数据部分和IP数据
##### 生存时间
###### 初始值为64
##### 协议
###### 即数据传输协议，用于实现在传输层的分用，常见的有UDP和TCP
##### 源地址
###### 即表示从哪个IP地址发出，一般情况下不会变动，除非有NAT
##### 目的地地址
###### 一般不变动
#### IP地址
##### IPV4地址
###### A类
* 8位地址位
* 最大可用网络数为2^7-2
    * 全0不可用，表示网络本身，即给路由器记录路由表用
    * 全1表示环路自检
###### B类
* 16位地址
###### C类
* 24位地址
###### 路由器总是有两个或者两个以上的IP地址，也有两个或者两个以上的MAC地址
##### 网络地址转换
###### 解决地址枯竭的一个举措
###### 有三种内网地址
* 常出现在大题中作为隐含条件
###### NAT转换表中存放着内网的IP地址和端口号，对应公网IP
###### 因为NAT路由器需要传输层的端口进行数据的分用，因此NAT路由器是工作在传输层的设备
#### 子网划分和CIDR
##### 子网划分就是一个单位内部的事情，采用子网划分和子网掩码可以实现广播域的隔离
##### 子网掩码
###### 子网掩码很简单，即用子网掩码表示整个子网中网络位数究竟占多少位
##### 题目中常给出一个网络让我们根据要求划分子网
###### 主机号全0不能用，因为他表示网络本身
###### 主机号全1不能用，因为表示这个局域网内的广播地址
###### 全0和全1的子网一般来说是可以用的，但是能避免就尽量避免
##### 两种默认地址和子网掩码
###### 互联网：0.0.0.0/0，子网掩码为255.255。255。255
###### 公网（DNS服务器）：子网掩码为2:5.255.255.255
##### CIDR
###### 常用于合并路由表
###### 两个子网可以通过向前取一位网络地址的方式进行聚合，减少路由表项目
#### 三大协议
##### ARP
###### 作用：根据IP地址查询MAC地址，即通过目的IP地址解析出MAC地址，实现点到点的传输
###### 工作在网络层
###### 过程
* 如果ARP表目中没有，则广播，即发送一条FF-FF-FF-FF-FF-FF的报文到所有路由器
* 此后会有单播回复，回复内容中包含主机B的IP和MAC地址的对应关系
* 如果有对应映射则直接按物理地址发送即可
##### DHCP
###### 动态分配IP地址
###### 工作在应用层
* 因为IP地址都没有，无法根据在网络层工作，更无法通过套接字建立连接
###### 全部都使用广播方式进行交互
* 目的地址为255。255。255.255这种全网广播地址，实际上是在局域网内广播
* 源地址为0.0.0.0
##### ICMP
###### 实现网络层差错的纠正
* 封装在IP数据报中
* 用于报告IP数据报发送错误
* 封装在IP数据报中发送
* 报文本身出错则不再处理
* 缺乏差错控制机制
###### 工作在网络层
### IPV6
#### 与IPV4的区别
##### IPV4地址长32位，IPV6长128位
##### IPV6不提供首部校验
###### IPV4检验首部
###### UDP检验首部
###### TCP检验首部和数据项
##### 如果数据太大而不能发送，会被直接丢弃
##### 是解决地址枯竭的根本办法
### 路由表
#### 路由表的书写
##### 如果连接的是互联网 目的地址写为0.0.0.0/0即可
##### 如果直连局域网，则下一跳不必填写
##### 如果题目中给出尽量少路由表条目，则对于同一个路由表接口出去的超网进行聚合
##### 路由器直连的端口属于同一个子网，对于xxx/30这种只有两个地址的子网划分，通常默认另一个IP就是本路由的IP
##### 路由器的端口也会占用一个子网地址，在大题目中需要注意路由器的子网地址占用情况
### IP组播
#### 组播D类地址：224.0.0.0～239.255.255.255
#### D类IP地址的后23用作组播MAC地址
#### 为了避免路由环路，采用构造组播转发树的方法，因为树中一定不存在环路
#### 实现方式
##### 组播靠路由器来实现，这需要路由器可以识别组播，以太网上实现组播方便很多，因为以太网本身支持广播和组播，而因特网上的路由器和物理网络都不支持广播和组播
#### 组播，单播 和广播 区别
##### 单播
###### 一对一
##### 多播
###### 有选择的一对多，比如告诉某一个部门
##### 广播
###### 整个广播域内的人都知道
#### 基于UDP，尽最大可能交付
### 移动IP
#### 几个名词的类比
##### 归属代理：村子
##### 移动结点：手机
##### 永久地址：手机卡ID
##### 外部代理：旅游景点
##### 转交地址：旅游景点ID
#### 实现过程
##### 在本地时采用一个IP地址，按照TCP/IP进行连接
##### 在外部结点漫游时，申请一个移动ID和永久地址ID进行隧道通通信，建立了这个链接之后，移动结点不能直接通过移动ID发送数据也不能通过移动ID接受数据，都是通过两个结点直接进行周转通信
##### 主地址固定，而辅地址会改变
### 网络层设备
#### 路由器
（用于网际通信和隔离广播域）
##### 普通路由器
###### 网络层
##### NAT路由器
###### 传输层
#### 几个硬件
##### 转发表值的算法
###### 路由算法
##### 计算路由信息
###### 路由选择处理机
##### 路由的分组转发部分
（分组转发部分）
###### 输入队列
###### 输出队列
###### 交换结构
##### 路由的选择处理部分
（控制部分）
###### 路由选择处理机
###### 路由选择协议
###### 路由表
#### 跨网段传输IP数据包（包含地址解析过程步骤）
##### 构造一个带有源地址和目的地址的IP数据报
##### 发现不在同一子网，不可以直接交付，传送给数据链路层
##### 主机H1通过ARP协议得到路由器对应的MAC地址，把H1的MAC地址作为源地址封装Ip数据报的桢，然后发送该桢
##### 路由R1收到这个桢，去除桢头和桢尾，得到IP数据报根据IP数据报中的信息去查找路由表，得到下一跳地址与之相连
##### 路由器R1查到与主机H2直接相连，因此得到主机H2的MAC地址，把桢发送给主机Ｈ2即可
#### 没有路由表映射的，丢弃
## 传输层
### 传输层提供的服务
#### 传输层的功能
##### 实现端到端的通信，即运行在不同主机上的应用进程之间提供了逻辑通信
##### 分用和复用
###### 分用
* 指接收方可以在传输层剥去接收到的报文首部，传输给对应的应用进程
* 类似于一个大家庭中的收信人，再拿到信之后根据上面的名字，交给对应的人
###### 复用
* 不同的应用进程可以采用同一个传输层协议进行通信
* 类似于一个大家庭中的收发信人，可以同时收集大家庭中的所有的信交给邮差
#### 传输层的寻址与端口
##### 端口的作用
###### 可以让进程将其数据交付给传输层，以及让传输层知道从哪里交付给应用层
###### SAP：sevice access point 第N+1层访问第N层服务的地方
###### 传输层的SAP是端口，网络层的SAP是IP地址，链路层的SAP是MAC地址
##### 端口号
###### 0～1023为熟知端口号
* 0～03FF
###### 1024～49151为登记端口号
* 1024～49151
###### 49152～6535为短暂端口号
* C000～FFFF
##### 套接字
###### 套接字用于唯一的识别一台主机和主机之上的那个应用
###### UDP传输套接字
* <目的 IP，目的端口号>
###### TCP传输套接字
* <源IP，源端口号，目的IP，目的端口号>
#### 无连接服务和面向连接服务
##### TCP
###### 提供面向连接的服务，提供一条全双工的可靠逻辑信道
###### 主要适用于FTP，STMP，TELNEt
###### 采用确认机制对传输数据进行确认，而不是采用面向连接的会话
* 实际上面向连接就是用确认机制来实现的
* 但是确认机制不一定只是为了实现面向连接
##### UDP
###### 提供无连接的非可靠传输
###### 主要适用于DNS，SNMP
##### TCP和UDP分别拥有自己的端口号，他们互不干扰，可以共存于一台主机
### UDP协议
#### 并不是不提供任何服务，而是在网络层的数据包服务之上增加了两个基本服务
##### 复用分用和差错检测
#### 使用UDP而不使用TCP的原因
##### UDP无需建立连接，没有握手过程延迟
##### 无连接状态，因此支持更多的活动客户机
##### 分组首部开销小，TCP最小20B，UDP只有8B，数据传输率较高
##### 可以更加精细的控制要发送的数据和发送实现，没有拥塞控制，适用于那些可以容忍数据丢失而不允许有较大时延的进程
#### UDP的首部格式
##### 原端口（2B）
###### 如果不需要对方回信可以全部置0
##### 目的端口（2B）
###### 表明要传输到的端口，由接收方端口分用后传输到对应进程
##### 数据包长度（2B）
###### 整个数据报的长度，最小值为8B，即仅有首部
##### 校验和（2B）
###### 检测UDP数据报是否有错
###### UDP校验
* 校验和字段使用是可选的，若用户选择不使用校验和，可以把校验和字段全部置为0
* UDP校验的是包括首部和数据的全部值
* UDP在校验时需要添加一个伪首部，这个首部不用做校验
* 若在接收方没有差错，则校验的结果全部都为1，若出现一点差错，则校验结果出现0，UDP没有纠错功能
### TCP协议
#### TCP协议的特点
##### 面向连接的传输层协议
##### 只能有两个端点，是点对点一对一的，但是与链路层的一对一不一样，这里是逻辑上一对一
##### TCP凭借确认机制提供可靠的交付服务，保证传送的数据无差错且不丢失
##### TCP提供全双工通信
###### 发送缓存
* 发送应用程序传送给发送方TCP准备发送的数据
* TCP已发送但尚未收到确认的数据
###### 接受缓存
* 按序到达但尚未被接受应用程序 读取的数据
* 不按序到达的数据
##### TCP的传输面向字节流，且确认机制为覆盖机制，传送序号单位为字节
#### TCP首段的组成
##### 原端口和目的端口
##### 序号字段
###### 以字节为单位编号，若序号字段为301，数据共有100B，下一个报文段从401开始
##### 确认号字段
###### 覆盖接受，若发送方传送101，201，301给接收方，但是接收方只收到了101，301，则返回给ack=201，若全部收到，则直接返回ack=401
##### 数据偏移
###### 这个数据偏移表示首部长度，这个在问答题里面可能会问TCP报文段首部常多少，单位为4B，与IP数据报的片偏移单位8B要区分开
##### 保留字段
###### 没啥用，可以忽略不计
##### 6个状态位
###### 主要关注SYN，ACK，FIN
##### 窗口字段（接受窗口）
###### 表示允许对方发送的最长字段
###### 用于流量控制中，特别要注意，如果发送方发送了101，201给接收方，但是接收方发回ack=201，rwnd=200，则此时发送方不能发送200B新数据，要重新发送201，再发送301
##### 校验和
##### 紧急指针字段
##### 选项字段
##### 填充字段
#### TCP连接管理
##### TCP链接的建立
###### 三次握手
###### 我是A，你能听到吗
* SYN=1，seq=x
###### 我是B，你能听到吗
* SYN=1，ACK=1，seq=y，ack=x+1
###### 听得到
* ACK=1，seq=x+1，ack=y+1
###### 为什么不能是两次握手？
* 因为如果只有两次握手，如果第一次握手传输失败卡在网路中，发送方重传然后传输完数据，这个数据帧突然发送过去了，但是此时已经不需要传输数据，由于只有两次握手没有第三次的确认过程，会浪费服务器的数据
###### SYN泛洪攻击
* 由于资源分配的时间差，客户分配资源是在三次握手完成之后，而服务器资源分配是在第二次握手完成，因此黑客可以通过发送大量的SUN请求而不做第三次握手，浪费服务器资源
##### TCP连接的断开
###### 四次挥手
###### 我要走了
* FIN=1，seq=u
###### 好的我这边数据传完再走，传完联系你
* ACK=1，seq=v，ack=u+1
###### 我传完了，我也要走了
* FIN=1，ACK=1，seq=w，ack=u+1
###### 好的收到，你走吧
* ACK=1，seq=u+1，ack=w+1
###### 为什么第四次挥手结束需要等待2MSL
* 因为如果客户端直接关闭连接而不等待，玩意第四次握手报文没传到服务器那里，服务器会一直等着这个报文，而此时链接已经关闭。等待2MSL（报文段最长寿命），可以有充足时间接受服务器的要求重传请求，可以顺利关闭连接
###### 为什么是四次挥手而不是三次挥手
（特殊情况下也可以是三次挥手）
* 因为断开是一方的，另一方还要传输数据
* 因而如果双方恰好都没有冗余数据传输，那么四次挥手可以简化为三次挥手，第二次挥手服务器确认桢变为 ACK=1，FIN=1，seq=w，ack=u+！
    * 此时的传输时延仅为1.5.rtt
#### TCP拥塞控制和流量控制
##### 流量控制
###### 由接收方决定，在确认桢中的RWND字段告诉发送方自己的缓存中还能装下多少内容
###### 与链路层流量控制的区别
* 传输层定义端到端，数据链路层定义相邻结点
* 数据链路层的窗口大小不可以动态变化，而传输层的窗口可以动态变化
###### 有的题目只给了接收方缓存，要根据每次传过来的文件大小动态修改接收方缓存大小
##### 拥塞控制
###### 由发送方决定，根据整条链路的拥塞情况决定自己可以发多大的桢
###### 慢开始和拥塞避免
* 在门限制之下指数增长
* 超过门限值逐个试探
* 拥塞后把拥塞值/2作为新的门限值
* 下一轮从1重新开始
###### 快重传和快恢复
* 快重传
    * 三个冗余ACK告诉发送方这个桢丢了
    * 快恢复，从慢开始的基础上进行改良，即不从1开始，而是直接从新的门限值线性增长
###### 这里指数增长的真正原因是在没达到门限值之前，接收方的缓存通常冗余很多，而此时拥塞流量可以指数上升，在每个RTT内会有多个确认桢，在拥塞窗口小于接受窗口的情况下，拥塞窗口会一直指数上升
* 若说的是多少个RTT之后的传输窗口，直接把CWND，RWND，SWND都写出来分析就行
* 若问的是多少个确认段之后，则需要把每个RTT内点确认段都拆开，逐个计算
##### 发送窗口=min（接受窗口，拥塞窗口），同时发送窗口+接受窗口≤帧序号
#### TCP传输效率
##### 吞吐率
###### 周期内传输大小/周期
* 周期=RTT+发送文件传输时延+接受文件传输时延
* 文件大小=TCP数据报长度，单位通常为B，计算吞吐率要转化为bit
###### 给定桢序号和报文段寿命
* 若桢序号为8位，则在生命周期内最多有127个报文段存在，否则会引起二义
###### RTT估计值
* RTT估计值=（1-a）*旧RTT测量值+a*新RTT测量值
## 应用层
### 网络应用模型
#### C/S（客户/服务器模型）
##### 可扩展性不佳，性能受到服务器硬件和网络带宽的限制
##### PC之间的地位不平等
##### 客户机面向任务，而服务器面向客户
#### P2P模型
##### 优点
###### 客户机之间地位平等，并且可以直接通信
###### 减轻了服务器的计算压力
###### 可扩展性好，网络健壮性强
##### 缺点
###### 在获取服务的同时，还要给其他结点提供服务，占用内存空间
###### 经常进行P2P下载会对硬盘造成损伤
##### 注意
###### P2P网络是一种动态的逻辑网络，其通过与服务器的物理链路构建
#### 主要区别
##### cs模型中客户和服务器之间的地位不对等，客户需要提前知道服务器的地址，而服务器不需要提前知道客户的地址
##### P2P模型中的对等结点具有直接通信能力
##### CS模型中客户机与客户机之间并不能直接通信
### DNS（domain name system）（udp）（cs）
#### 层次域名空间
##### 根域名
###### COM后面的那个点
##### 顶级域名
###### 国家顶级域名（uk）
###### 通用顶级域名（com）
###### 基础结构域名，也叫反向域名，这种域名只有一个
##### 二级域名
###### edu，bj，google
##### 三级域名
###### www，hdu
##### 四级域名
###### www，mail
#### 域名服务器
##### 根域名服务器
##### 顶级域名服务器
##### 授权域名服务器
###### 只有授权域名服务器总可以吧域名解析为IP地址
##### 本地域名服务器（实际上不属于域名服务器层级）
#### 域名解析过程
##### 递归查询
###### 缓存在高级域名服务器中
##### 迭代与递归查询相结合
###### 换存在本地域名服务器中
#####   注意 
###### 无论哪种查询方式，和用户主机直接交互的都只有本地域名服务器
###### 递归方式的本地域名服务器发出一条请求给根域名服务器，迭代方式的本地服务器发出多条请求给不同级别的域名服务器
###### 以迭代方式解析域名，发出DNS查询的次数最少为0次（本地中存了），最多为4次（根->com->sc.com->www.sc.com）
###### DNS采用UDP（用户数据报这种不可靠的方式）
###### DNS访问采用UDP这种不可靠的链接协议而不采用TCP协议是因为DNS访问不需要出错重传，CS架构中的服务器永远存储着下级域名的信息，且这种信息一般来说不会改变，如果第一次访问出错，则直接通过计时器在申请访问一次即可，这样的请求方式会比TCP三次握手，四次挥手效率高得多
#### 几种对应关系
##### 一个域名可以对应多个IP地址（双网卡），多个MAC地址，多个主机
###### 一个主机只要有多个网卡就行了，可以一个DNS名称对应多个IP和多个MAC
* 但是这两个与MAC绑定的主机不可以是同属于一个网络的，同处于一个局域网会发生冲突
###### 一个DNS地址也可以对应多个主机，比如12306，高峰时采用分布式计算方法减少压力
##### 一台计算机可以同时拥有两个顶级域名的DNS名字，也可以拥有两个授权域名的DNS名字
### FTP（file transfer protocol）（tcp）（cs）
#### 工作原理
##### 主机与服务器通过TCP建立连接，链接到服务器的21号端口，发送登陆账号与密码
##### 服务器返回登陆成功信息后，主机A打开一个（！随机端口！），并将该端口发送给服务器
##### 主机A发送读取命令，服务器打开20号端口建立与主机刚刚发送端口的连接
##### 服务器把文件内容通过数据连接发给主机，传输完成后立即关闭数据端口，控制端口等到主机挥手时在关闭
#### 控制链接
##### 服务器监听21号端口，收到主机请求则打开连接
##### 整个会话期间一直保持打开状态
##### 用于传输客户与服务器之间的FTP命令
#### 数据连接
##### 采用服务器的20号端口，与主机的随机发送端口建立连接
##### 数据发送完毕立即关闭数据连接
#### 特点
##### 允许客户指明文件的类型与格式
##### 可以在两个不同的操作系统之间传输文件（都在应用层面传输，操作系统对其透明）
##### 适用于两个计算机之间共享读写文件（建立了TCP链接）
#### 采用两种链接可以提高数据传输的效率，并且可以在数据传输的过程中暂停和请求终止
### 电子邮件（tcp）cs
#### 组成
##### 用户代理
###### 是一个运行在PC上的程序
###### OUTLOOK foxmail
###### 撰写，显示，邮件处理的功能
##### 邮件服务器
###### 组成电子邮件的核心
###### 功能
* 发送和接收邮件
* 向发信人报告邮件的情况
##### 协议
###### SMTP（push）
* SMTP：simple mail transfer protocol
* 用于从用户代理处把邮件发到发送端邮件服务器
* 从发送端邮件服务器发送到接受端邮件服务器
* 采用TCP协议，熟知端口号为25
* 邮件发送完毕，由客户发送结束命令，SMTP服务器返回221（从端口25发出），
###### POP3（IMAP）（pull）
* pop：post office protocol
* IMAP：internet mail access protocol
* 采用TCP协议，熟知端口号为110
* 从接受端邮件服务器送到用户代理处
* 由客户端而非服务器选择接受后是否将邮件保存在服务器上
* 一个账号在服务器上只能有一个邮件接收目录
###### http
* 只有发送端和接收端服务器之间的信息传输采用SMTP，用户代理和邮件服务器无论是push还是pull均采用http
    * HTTP也是基于TCP的
#### 电子邮件格式和MIME
##### MIME:multipurpose internet mail extension(多用途互联网邮件扩展)
##### MIMIE
###### 解决原本SMTP只能传输ASCALL码的问题，在其基础上添加了其余编码的编码规则，使其可以传输图片等文件
##### 电子邮件格式
###### 信封
###### 内容
* 首部
    * from
    * to
    * subject（主题）
* 主体
### 万维网（tcp）cs
#### WWW（world wide web）是一个资料空间，在这个空间中一样有用的东西叫做一样资源，并由一个全域统一资源定位符URL（uniform resource location）标识，这些资源通过超文本传输协议http（hypertext transfer protocol）传送给使用者
#### 内核部分的三个标准
##### URL
###### <协议>://<主机>:<端口>/<路径>
###### 端口和路径可以被省略，因此可以用http（ftp）//www.pku.edu.cn表示一个完整的URL
###### URL不区分大小写
###### 用户通过输入URL就可以经过HTTP协议访问到相应资源，即标识万维网上的各种文件
##### HTML
###### HTML：hypertext maskup language
###### 使得万维网页面设计者很方便的从一个界面的链接转到另一个界面，并能够在自己的屏幕上显示出来
###### 用户点击它就可以通过http协议访问资源
##### HTTP
###### 操作过程
* 监听熟知端口80
###### 特点
* HTTP是无状态的，可以用COOKIE来记录用户访问信息
* HTTP采用TCP作为运输层协议，但是HTTP本身是无连接的（通信双方在交换HTTP报文之前不需要先建立HTTP链接）
* HTTP连接方式
    * 持久连接
        * 非流水线
            * 只能发送一个请求桢，收到了文件之后才能请求下个文件
            * 例如传输N个发送时延为ts的文件，总共传输时间TCP连接（2RTT）+N*（RTT+文件传输延迟）
        * 流水线
            * 类似于GBN协议，可以同时发送多个请求桢
            * 例如传输N个发送时延为ts的文件，总共传输时间为1个RTT（建立tcp）+（1RTT+N*传输延迟）
        * 持久连接：在TCP连接后的一段时间里还可以再次传输文件而不需要重新建立连接
    * 非持久连接
        * 一次TCP握手连接只能传输一个文本，传输完成后断开连接，还要进行链接的话需要再次请求
        * 例如传输N个发送时延为ts的文件，如果TCP连接第三次可以夹带URL，则总时间=第一次建立TCP链接（2RTT）+后续文件个数*（2RTT+文件传输延迟）
    * 总结
持久连接-非流水线=n*RTT
非流水线-流水线=n*RTT
###### 报文结构
* 请求报文
* 确认报文
* 都是面向文本的，报文中的每一个字段都是一些ASCALL码串
### 熟知端口
#### ftp数据连接：20
#### ftp控制链接：21
##### file transfer protocol control connection
#### telnet：23
##### 远程登录
##### telecom munication network protocol
#### smtp：25
##### 简单邮件传输
##### simple mail transfer protocol
#### dns：53
##### 域名系统
##### domain name system
#### tftp：69
##### 小文件传送协议
##### trivial file transfer protocol
#### HTTP：80
##### 超文本传输协议
##### hypertext transfer protocol
#### POP3:110
##### 邮局协议
##### post office protocol
#### SNMP：161
##### 简单网络管理协议
##### simple netwoek manager protocol
## 计算机网络概述
### 几个小概念
#### 传输速率
##### 进入链路的速度
#### 带宽
##### 最大传输速率
#### 传播速率
##### 向前传播的速度
#### 传输时延
##### 进入链路的时间
#### 发送时延
##### 等于传输时延
#### 传播时延
##### 向前传输的耗时，来回传输时延称为RTT
### OSI的两种划分
#### 物理层
#### 数据链路层
#### 网络层
#### 传输层
#### 会话层
#### 表示层
#### 应用层
#### 通信子网
#### 资源子网
### OSI与TCP/IP的区别
#### 特别注意HDLC是OSI的协议
#### OSI模型在网络层支持无连接和面向连接的通信，在传输层只有面向连接的通信，而TCP/IP认为连接是端到端的问题，因此传输层提供连接（TCP）和无连接（UDP）两种方式
### 基本上考试就考这些层的主要功能，记住第几层是啥是干嘛的就行，“物联网淑慧适用”
